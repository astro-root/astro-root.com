<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Responsive Design Tester</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #12121a;
    --border: #1e1e2e;
    --accent: #00e5ff;
    --accent2: #ff3d71;
    --text: #e0e0f0;
    --muted: #5a5a7a;
    --panel: #0f0f18;
    --success: #00e5a0;
    --warn: #ffaa44;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  header {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 10px 20px;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    flex-shrink: 0;
    flex-wrap: wrap;
  }

  .logo {
    font-size: 1.1rem;
    font-weight: 800;
    letter-spacing: -0.5px;
    color: var(--accent);
    white-space: nowrap;
  }
  .logo span { color: var(--accent2); }

  .url-form {
    display: flex;
    flex: 1;
    gap: 6px;
    min-width: 280px;
    position: relative;
  }

  .url-input-wrap {
    flex: 1;
    position: relative;
    display: flex;
    align-items: center;
  }

  .url-input {
    width: 100%;
    background: var(--border);
    border: 1px solid #2a2a3e;
    border-radius: 6px;
    padding: 7px 36px 7px 12px;
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.82rem;
    outline: none;
    transition: border-color 0.2s;
  }
  .url-input:focus { border-color: var(--accent); }
  .url-input.error { border-color: var(--accent2); }

  .url-clear {
    position: absolute;
    right: 8px;
    background: none;
    border: none;
    color: var(--muted);
    cursor: pointer;
    font-size: 1rem;
    line-height: 1;
    padding: 2px 4px;
    border-radius: 4px;
    display: none;
    transition: color 0.15s;
  }
  .url-clear:hover { color: var(--accent2); }
  .url-clear.visible { display: block; }

  .btn {
    background: var(--accent);
    color: #000;
    border: none;
    border-radius: 6px;
    padding: 7px 16px;
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    font-size: 0.82rem;
    cursor: pointer;
    transition: opacity 0.2s;
    white-space: nowrap;
  }
  .btn:hover { opacity: 0.85; }
  .btn:disabled { opacity: 0.4; cursor: not-allowed; }
  .btn.secondary {
    background: var(--border);
    color: var(--text);
    border: 1px solid #2a2a3e;
  }
  .btn.secondary:hover { border-color: var(--accent); color: var(--accent); }

  .header-actions {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
  }

  select {
    background: var(--border);
    border: 1px solid #2a2a3e;
    border-radius: 6px;
    padding: 7px 10px;
    color: var(--text);
    font-family: 'Syne', sans-serif;
    font-size: 0.82rem;
    cursor: pointer;
    outline: none;
  }

  #device-bar {
    display: flex;
    gap: 6px;
    padding: 8px 14px;
    background: var(--panel);
    border-bottom: 1px solid var(--border);
    overflow-x: auto;
    flex-shrink: 0;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }

  .category-label {
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--muted);
    align-self: center;
    white-space: nowrap;
    padding: 0 6px;
    border-left: 2px solid var(--border);
  }
  .category-label:first-child { border-left: none; }

  .device-chip {
    display: flex;
    align-items: center;
    gap: 5px;
    background: var(--border);
    border: 1px solid transparent;
    border-radius: 20px;
    padding: 4px 11px;
    font-size: 0.72rem;
    font-family: 'JetBrains Mono', monospace;
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.15s;
    color: var(--text);
  }
  .device-chip:hover { border-color: var(--accent); color: var(--accent); }
  .device-chip.active { background: var(--accent); color: #000; border-color: var(--accent); font-weight: 700; }
  .device-chip svg { width: 12px; height: 12px; flex-shrink: 0; }

  #stage {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: auto;
    padding: 24px;
    background:
      radial-gradient(ellipse at 20% 30%, rgba(0,229,255,0.04) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 70%, rgba(255,61,113,0.04) 0%, transparent 50%),
      var(--bg);
  }

  .device-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    animation: fadeIn 0.25s ease;
  }
  @keyframes fadeIn { from { opacity: 0; transform: scale(0.97); } to { opacity: 1; transform: scale(1); } }

  .device-info {
    display: flex;
    gap: 16px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    color: var(--muted);
    align-items: center;
    flex-wrap: wrap;
  }
  .device-info span { color: var(--accent); }

  .device-actions {
    display: flex;
    gap: 6px;
    margin-left: auto;
  }

  .icon-btn {
    background: var(--border);
    border: 1px solid #2a2a3e;
    border-radius: 5px;
    color: var(--muted);
    cursor: pointer;
    padding: 4px 8px;
    font-size: 0.75rem;
    font-family: 'JetBrains Mono', monospace;
    display: flex;
    align-items: center;
    gap: 4px;
    transition: all 0.15s;
    white-space: nowrap;
  }
  .icon-btn:hover { border-color: var(--accent); color: var(--accent); }
  .icon-btn svg { width: 12px; height: 12px; }

  .phone-shell {
    position: relative;
    border-radius: 36px;
    background: #1a1a2a;
    box-shadow:
      0 0 0 1px #2a2a3e,
      0 0 0 6px #12121e,
      0 0 0 7px #2a2a3e,
      0 30px 80px rgba(0,0,0,0.7),
      inset 0 0 30px rgba(255,255,255,0.02);
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .phone-shell.landscape { border-radius: 28px; }

  .notch {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 90px;
    height: 26px;
    background: #0a0a0f;
    border-radius: 20px;
    z-index: 10;
    box-shadow: 0 0 0 1px #1e1e2e;
  }
  .notch.island { width: 110px; height: 30px; top: 10px; border-radius: 22px; }
  .notch.none { display: none; }
  .notch.android { width: 12px; height: 12px; border-radius: 50%; top: 14px; }
  .notch.full-hole { width: 14px; height: 14px; border-radius: 50%; top: 12px; }

  .screen-area {
    border-radius: 28px;
    overflow: hidden;
    position: absolute;
  }
  .phone-shell.landscape .screen-area { border-radius: 22px; }

  .screen-area iframe {
    display: block;
    border: none;
    background: #fff;
    transform-origin: 0 0;
  }

  .loading-overlay {
    position: absolute;
    inset: 0;
    background: #0a0a0f;
    border-radius: inherit;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 12px;
    z-index: 20;
    transition: opacity 0.3s;
  }
  .loading-overlay.hidden { opacity: 0; pointer-events: none; }

  .spinner {
    width: 28px;
    height: 28px;
    border: 2px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  .loading-text {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: var(--muted);
  }

  .error-overlay {
    position: absolute;
    inset: 0;
    background: #0a0a0f;
    border-radius: inherit;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 10px;
    z-index: 20;
    padding: 20px;
    text-align: center;
  }
  .error-overlay.show { display: flex; }
  .error-overlay svg { width: 36px; height: 36px; color: var(--accent2); opacity: 0.7; }
  .error-overlay h3 { font-size: 0.9rem; color: var(--text); }
  .error-overlay p { font-size: 0.72rem; font-family: 'JetBrains Mono', monospace; color: var(--muted); line-height: 1.6; }
  .error-overlay a { color: var(--accent); text-decoration: none; font-size: 0.75rem; }
  .error-overlay a:hover { text-decoration: underline; }

  .home-indicator {
    position: absolute;
    bottom: 8px;
    left: 50%;
    transform: translateX(-50%);
    height: 4px;
    background: rgba(255,255,255,0.25);
    border-radius: 3px;
  }

  .custom-inputs {
    display: none;
    align-items: center;
    gap: 6px;
    font-size: 0.8rem;
    font-family: 'JetBrains Mono', monospace;
  }
  .custom-inputs.show { display: flex; }
  .custom-inputs input {
    width: 64px;
    background: var(--border);
    border: 1px solid #2a2a3e;
    border-radius: 4px;
    padding: 5px 8px;
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
    text-align: center;
    outline: none;
  }
  .custom-inputs input:focus { border-color: var(--accent); }

  #rotate-btn {
    background: var(--border);
    border: 1px solid #2a2a3e;
    color: var(--text);
    border-radius: 6px;
    padding: 7px 12px;
    font-size: 0.82rem;
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 5px;
  }
  #rotate-btn:hover { border-color: var(--accent); color: var(--accent); }
  #rotate-btn svg { width: 14px; height: 14px; transition: transform 0.3s; }
  #rotate-btn.rotated svg { transform: rotate(90deg); }

  .scale-note {
    font-size: 0.7rem;
    font-family: 'JetBrains Mono', monospace;
    color: var(--muted);
    text-align: center;
  }

  .empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    color: var(--muted);
    text-align: center;
  }
  .empty-state svg { width: 64px; height: 64px; opacity: 0.3; }
  .empty-state h2 { font-size: 1.2rem; color: var(--text); opacity: 0.5; }
  .empty-state p { font-size: 0.82rem; font-family: 'JetBrains Mono', monospace; }

  .toast {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%) translateY(0);
    background: var(--surface);
    border: 1px solid var(--accent);
    color: var(--accent);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.78rem;
    padding: 8px 18px;
    border-radius: 20px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s;
    white-space: nowrap;
    z-index: 999;
  }
  .toast.show { opacity: 1; }

  .url-error-msg {
    display: none;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.72rem;
    color: var(--accent2);
    position: absolute;
    bottom: -18px;
    left: 0;
  }
  .url-error-msg.show { display: block; }
</style>
</head>
<body>

<header>
  <div class="logo">RESP<span>.</span>TEST</div>

  <div class="url-form">
    <div class="url-input-wrap">
      <input type="text" id="url-input" class="url-input" placeholder="https://example.com" autocomplete="off" spellcheck="false">
      <button class="url-clear" id="url-clear" title="クリア" onclick="clearURL()">✕</button>
    </div>
    <button class="btn" onclick="loadURL()">LOAD</button>
  </div>

  <div class="header-actions">
    <div class="custom-inputs show" id="custom-inputs">
      <span style="color:var(--muted)">W:</span>
      <input type="number" id="custom-w" placeholder="390" min="200" max="2000">
      <span style="color:var(--muted)">H:</span>
      <input type="number" id="custom-h" placeholder="844" min="400" max="3000">
      <button class="btn" onclick="applyCustom()">APPLY</button>
    </div>

    <button id="rotate-btn" onclick="toggleRotate()" title="横向き/縦向き切替">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <path d="M4 10V6a2 2 0 0 1 2-2h10"/>
        <path d="M20 14v4a2 2 0 0 1-2 2H8"/>
        <polyline points="16 6 20 10 16 14" transform="rotate(90 18 10)"/>
      </svg>
      回転
    </button>

    <select id="scale-select" onchange="updateScale()">
      <option value="0.35">35%</option>
      <option value="0.4">40%</option>
      <option value="0.5">50%</option>
      <option value="0.6">60%</option>
      <option value="0.7" selected>70%</option>
      <option value="0.8">80%</option>
      <option value="1.0">100%</option>
    </select>
  </div>
</header>

<div id="device-bar">
  <span class="category-label">iPhone</span>
  <button class="device-chip" onclick="setDevice(this)" data-w="393" data-h="852" data-name="iPhone 15 Pro" data-notch="island">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="3"/></svg>15 Pro
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="430" data-h="932" data-name="iPhone 15 Pro Max" data-notch="island">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="3"/></svg>15 Pro Max
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="390" data-h="844" data-name="iPhone 14 / 15" data-notch="island">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="3"/></svg>14 / 15
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="428" data-h="926" data-name="iPhone 14 Plus" data-notch="island">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="3"/></svg>14 Plus
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="390" data-h="844" data-name="iPhone 12 / 13" data-notch="notch">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="3"/></svg>12 / 13
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="375" data-h="812" data-name="iPhone X / XS / 11 Pro" data-notch="notch">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="3"/></svg>X / XS
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="414" data-h="896" data-name="iPhone XR / 11" data-notch="notch">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="3"/></svg>XR / 11
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="375" data-h="667" data-name="iPhone SE (3rd gen)" data-notch="none">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="3"/></svg>SE 3rd
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="320" data-h="568" data-name="iPhone SE (1st)" data-notch="none">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="3"/></svg>SE 1st
  </button>

  <span class="category-label">Samsung Galaxy</span>
  <button class="device-chip" onclick="setDevice(this)" data-w="393" data-h="873" data-name="Galaxy S24" data-notch="full-hole">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="2"/></svg>S24
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="412" data-h="915" data-name="Galaxy S24 Ultra" data-notch="full-hole">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="2"/></svg>S24 Ultra
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="360" data-h="800" data-name="Galaxy S23" data-notch="full-hole">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="2"/></svg>S23
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="360" data-h="740" data-name="Galaxy A54" data-notch="full-hole">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="2"/></svg>A54
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="360" data-h="800" data-name="Galaxy A34" data-notch="full-hole">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="2"/></svg>A34
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="390" data-h="844" data-name="Galaxy Z Fold5 (外)" data-notch="android">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="2"/></svg>Fold5 外
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="848" data-h="1080" data-name="Galaxy Z Fold5 (内)" data-notch="android">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="2"/></svg>Fold5 内
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="360" data-h="748" data-name="Galaxy Z Flip5 (外)" data-notch="full-hole">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="2"/></svg>Flip5 外
  </button>

  <span class="category-label">Google Pixel</span>
  <button class="device-chip" onclick="setDevice(this)" data-w="393" data-h="851" data-name="Pixel 8" data-notch="full-hole">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="2"/></svg>Pixel 8
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="412" data-h="915" data-name="Pixel 8 Pro" data-notch="full-hole">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="2"/></svg>Pixel 8 Pro
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="360" data-h="800" data-name="Pixel 7a" data-notch="full-hole">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="2"/></svg>Pixel 7a
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="412" data-h="869" data-name="Pixel 6 Pro" data-notch="android">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="2"/></svg>Pixel 6 Pro
  </button>

  <span class="category-label">iPad / Tablet</span>
  <button class="device-chip" onclick="setDevice(this)" data-w="820" data-h="1180" data-name="iPad (10th)" data-notch="none">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="4" width="18" height="16" rx="2"/></svg>iPad 10
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="834" data-h="1194" data-name="iPad Air 5" data-notch="none">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="4" width="18" height="16" rx="2"/></svg>Air 5
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="1024" data-h="1366" data-name="iPad Pro 12.9" data-notch="none">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="4" width="18" height="16" rx="2"/></svg>Pro 12.9
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="744" data-h="1133" data-name="iPad mini 6" data-notch="none">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="4" width="18" height="16" rx="2"/></svg>mini 6
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="800" data-h="1280" data-name="Galaxy Tab S9" data-notch="android">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="4" width="18" height="16" rx="2"/></svg>Tab S9
  </button>

  <span class="category-label">日本向け</span>
  <button class="device-chip" onclick="setDevice(this)" data-w="393" data-h="873" data-name="AQUOS sense8" data-notch="android">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="2"/></svg>AQUOS s8
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="360" data-h="800" data-name="Xperia 5 V" data-notch="android">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="2"/></svg>Xperia 5V
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="412" data-h="915" data-name="Xperia 1 V" data-notch="android">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="2"/></svg>Xperia 1V
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="360" data-h="800" data-name="Xiaomi 13T" data-notch="full-hole">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="2"/></svg>Xiaomi 13T
  </button>
  <button class="device-chip" onclick="setDevice(this)" data-w="412" data-h="917" data-name="OPPO Reno10" data-notch="full-hole">
    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="2" width="14" height="20" rx="2"/></svg>OPPO Reno10
  </button>

  <span class="category-label">カスタム</span>
  <button class="device-chip active" onclick="setDevice(this)" data-w="custom" data-h="custom" data-name="カスタム" data-notch="island">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="9" y1="3" x2="9" y2="21"/><line x1="3" y1="9" x2="21" y2="9"/></svg>
    カスタムサイズ
  </button>
</div>

<div id="stage">
  <div class="empty-state" id="empty-state">
    <svg viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="1.5">
      <rect x="12" y="4" width="28" height="48" rx="5"/>
      <line x1="22" y1="8" x2="30" y2="8"/>
      <circle cx="26" cy="46" r="2"/>
      <path d="M46 20 L56 20 M51 15 L51 25" stroke-linecap="round"/>
      <path d="M44 32 Q50 26 56 32" stroke-linecap="round"/>
      <path d="M46 44 Q52 38 58 44" stroke-linecap="round"/>
    </svg>
    <h2>URLを入力してください</h2>
    <p>上のフォームにURLを入力し<br>LOADボタンを押してください</p>
    <p style="margin-top:8px;font-size:0.68rem;color:var(--muted)">※ X-Frame-Options や CSP でiframe拒否しているサイトは表示できません</p>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const PAD = {
  portrait:  { top: 52, bottom: 28, side: 12 },
  landscape: { top: 12, bottom: 12, side: 52 }
};

let device    = { w: 390, h: 844, name: 'カスタム', notch: 'island' };
let landscape = false;
let scale     = 0.7;
let currentURL = '';
let loadTimer  = null;

const urlInput  = document.getElementById('url-input');
const urlClear  = document.getElementById('url-clear');

urlInput.addEventListener('input', () => {
  urlClear.classList.toggle('visible', urlInput.value.length > 0);
  urlInput.classList.remove('error');
});

urlInput.addEventListener('keydown', e => {
  if (e.key === 'Enter') loadURL();
});

function clearURL() {
  urlInput.value = '';
  urlInput.classList.remove('error');
  urlClear.classList.remove('visible');
  urlInput.focus();
}

function showToast(msg, duration = 2000) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), duration);
}

function setDevice(el) {
  document.querySelectorAll('.device-chip').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  const isCustom = el.dataset.w === 'custom';
  document.getElementById('custom-inputs').classList.toggle('show', isCustom);
  if (!isCustom) {
    device = { w: +el.dataset.w, h: +el.dataset.h, name: el.dataset.name, notch: el.dataset.notch };
    renderDevice();
  }
}

function applyCustom() {
  const w = parseInt(document.getElementById('custom-w').value) || 390;
  const h = parseInt(document.getElementById('custom-h').value) || 844;
  device = { w, h, name: `Custom ${w}×${h}`, notch: 'island' };
  renderDevice();
}

function updateScale() {
  scale = +document.getElementById('scale-select').value;
  renderDevice();
}

function toggleRotate() {
  landscape = !landscape;
  const btn = document.getElementById('rotate-btn');
  btn.classList.toggle('rotated', landscape);
  renderDevice();
}

function isValidURL(str) {
  try {
    new URL(str);
    return true;
  } catch {
    return false;
  }
}

function loadURL() {
  let v = urlInput.value.trim();
  if (!v) return;
  if (!/^https?:\/\//i.test(v)) v = 'https://' + v;
  if (!isValidURL(v)) {
    urlInput.classList.add('error');
    showToast('⚠ 有効なURLを入力してください');
    return;
  }
  urlInput.value = v;
  urlInput.classList.remove('error');
  currentURL = v;
  renderDevice();
}

function copyURL() {
  if (!currentURL) return;
  navigator.clipboard.writeText(currentURL).then(() => showToast('✓ URLをコピーしました'));
}

function openInTab() {
  if (!currentURL) return;
  window.open(currentURL, '_blank', 'noopener,noreferrer');
}

function reload() {
  if (!currentURL) return;
  renderDevice();
}

function renderDevice() {
  const stage = document.getElementById('stage');

  if (!currentURL) {
    stage.innerHTML = '';
    const empty = document.getElementById('empty-state') || createEmptyState();
    stage.appendChild(empty);
    return;
  }

  const pw = landscape ? device.h : device.w;
  const ph = landscape ? device.w : device.h;
  const pad = landscape ? PAD.landscape : PAD.portrait;

  const shellW = pw + pad.side * 2;
  const shellH = ph + pad.top + pad.bottom;

  const sW = Math.round(shellW * scale);
  const sH = Math.round(shellH * scale);

  const notchType = (landscape && (device.notch === 'notch' || device.notch === 'island' || device.notch === 'pill'))
    ? 'android' : device.notch;

  const hasHomeBar = !landscape && (device.notch === 'island' || device.notch === 'notch' || device.notch === 'pill');

  let notchStyle = '';
  if (landscape && notchType === 'android') {
    notchStyle = `top:50%; left:${14 * scale}px; transform:translateY(-50%);`;
  }

  const screenLeft = Math.round(pad.side * scale);
  const screenTop  = Math.round(pad.top * scale);
  const screenW    = Math.round(pw * scale);
  const screenH    = Math.round(ph * scale);

  stage.innerHTML = `
    <div class="device-wrapper">
      <div class="device-info">
        <div>${device.name}</div>
        <div>• <span>${device.w}×${device.h}</span> CSS px</div>
        <div>• 表示: <span>${pw}×${ph}</span></div>
        <div>• <span>${Math.round(scale * 100)}%</span> scale</div>
        <div class="device-actions">
          <button class="icon-btn" onclick="reload()" title="再読み込み">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
            再読み込み
          </button>
          <button class="icon-btn" onclick="copyURL()" title="URLをコピー">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            URLコピー
          </button>
          <button class="icon-btn" onclick="openInTab()" title="新しいタブで開く">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
            新しいタブ
          </button>
        </div>
      </div>

      <div class="phone-shell ${landscape ? 'landscape' : ''}" style="width:${sW}px; height:${sH}px;">
        <div class="notch ${notchType}" style="${notchStyle}"></div>

        <div class="screen-area" style="left:${screenLeft}px; top:${screenTop}px; width:${screenW}px; height:${screenH}px;">
          <div class="loading-overlay" id="loading-overlay">
            <div class="spinner"></div>
            <div class="loading-text">読み込み中...</div>
          </div>
          <div class="error-overlay" id="error-overlay">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round">
              <circle cx="12" cy="12" r="10"/>
              <line x1="12" y1="8" x2="12" y2="12"/>
              <line x1="12" y1="16" x2="12.01" y2="16"/>
            </svg>
            <h3>表示できませんでした</h3>
            <p>このサイトは X-Frame-Options または<br>Content-Security-Policy により<br>iframe での表示を拒否しています。</p>
            <a href="${currentURL}" target="_blank" rel="noopener noreferrer">直接開く →</a>
          </div>
          <iframe
            id="preview-iframe"
            src="${currentURL}"
            width="${pw}"
            height="${ph}"
            style="transform:scale(${scale}); transform-origin:0 0; display:block; border:none; background:#fff;"
            sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox">
          </iframe>
        </div>

        ${hasHomeBar ? `<div class="home-indicator" style="width:${Math.round(120 * scale)}px; bottom:${Math.round(7 * scale)}px;"></div>` : ''}
      </div>

      <div class="scale-note">viewport ${pw}×${ph} px を ${Math.round(scale * 100)}% 縮小表示</div>
    </div>
  `;

  setupIframeEvents();
}

function setupIframeEvents() {
  const iframe  = document.getElementById('preview-iframe');
  const loading = document.getElementById('loading-overlay');
  const errBox  = document.getElementById('error-overlay');
  if (!iframe) return;

  if (loadTimer) clearTimeout(loadTimer);

  loadTimer = setTimeout(() => {
    try {
      const doc = iframe.contentDocument || iframe.contentWindow.document;
      if (!doc || doc.body === null || doc.body.innerHTML === '') {
        loading.classList.add('hidden');
        errBox.classList.add('show');
      }
    } catch {
      loading.classList.add('hidden');
      errBox.classList.add('show');
    }
  }, 6000);

  iframe.addEventListener('load', () => {
    clearTimeout(loadTimer);
    try {
      const doc = iframe.contentDocument || iframe.contentWindow.document;
      if (doc && doc.title !== '') {
        loading.classList.add('hidden');
      } else {
        loading.classList.add('hidden');
        errBox.classList.add('show');
      }
    } catch {
      loading.classList.add('hidden');
      errBox.classList.add('show');
    }
  });

  iframe.addEventListener('error', () => {
    clearTimeout(loadTimer);
    loading.classList.add('hidden');
    errBox.classList.add('show');
  });
}
</script>
</body>
</html>