<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Q-Room Monitor</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --bg: #09090b;
  --surface: rgba(24,24,27,0.75);
  --border: rgba(255,255,255,0.1);
  --cyan: #06b6d4;
  --magenta: #e11d48;
  --green: #10b981;
  --red: #ef4444;
  --yellow: #f59e0b;
  --orange: #f97316;
  --text: #f4f4f5;
  --muted: #a1a1aa;
  --en: 'Inter', sans-serif;
  --ja: 'Noto Sans JP', sans-serif;
  --mono: 'JetBrains Mono', monospace;
}
html, body {
  min-height: 100vh;
  background-color: var(--bg);
  background-image:
    radial-gradient(circle at 15% 20%, rgba(6,182,212,0.07) 0%, transparent 45%),
    radial-gradient(circle at 85% 80%, rgba(225,29,72,0.07) 0%, transparent 45%);
  color: var(--text);
  font-family: var(--ja);
}
.container {
  max-width: 860px;
  margin: 0 auto;
  padding: 40px 24px 80px;
}

/* ── HEADER ── */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 48px;
  gap: 16px;
  flex-wrap: wrap;
}
.logo-wrap { display: flex; align-items: baseline; gap: 12px; }
.logo {
  font-family: var(--en); font-size: 2rem; font-weight: 900;
  background: linear-gradient(135deg, #fff, var(--cyan));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  letter-spacing: 0.08em;
  filter: drop-shadow(0 4px 16px rgba(6,182,212,0.4));
}
.logo-tag {
  font-family: var(--mono); font-size: 0.75rem; color: var(--muted);
  background: rgba(255,255,255,0.06); border: 1px solid var(--border);
  border-radius: 6px; padding: 4px 10px; letter-spacing: 0.15em;
}
.status-row { display: flex; align-items: center; gap: 12px; }
.dot {
  width: 8px; height: 8px; border-radius: 50%; background: var(--green);
  box-shadow: 0 0 8px var(--green);
  animation: pulse 2s ease-in-out infinite;
}
.dot.offline { background: var(--red); box-shadow: 0 0 8px var(--red); animation: none; }
@keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.4;} }
.status-text { font-family: var(--mono); font-size: 0.8rem; color: var(--muted); letter-spacing: 0.1em; }
.next-refresh { font-family: var(--mono); font-size: 0.8rem; color: var(--muted); }

/* ── DISCLAIMER ── */
.disclaimer {
  background: rgba(245,158,11,0.08);
  border: 1px solid rgba(245,158,11,0.3);
  border-radius: 14px;
  padding: 14px 20px;
  margin-bottom: 32px;
  font-size: 0.85rem;
  color: #fcd34d;
  line-height: 1.6;
  letter-spacing: 0.02em;
}
.disclaimer strong { color: var(--yellow); }

/* ── CARDS GRID ── */
.cards-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  gap: 20px;
  margin-bottom: 32px;
}
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 28px;
  backdrop-filter: blur(24px);
  transition: all 0.3s cubic-bezier(0.16,1,0.3,1);
  position: relative; overflow: hidden;
}
.card:hover { transform: translateY(-3px); border-color: rgba(255,255,255,0.2); box-shadow: 0 12px 32px rgba(0,0,0,0.4); }
.card-label {
  font-family: var(--en); font-size: 0.72rem; font-weight: 700;
  color: var(--muted); letter-spacing: 0.2em; text-transform: uppercase;
  margin-bottom: 16px; display: flex; align-items: center; gap: 8px;
}
.card-label-dot { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }
.card-value {
  font-family: var(--en); font-size: 3rem; font-weight: 900;
  line-height: 1; letter-spacing: -0.03em; margin-bottom: 8px;
}
.card-sub {
  font-family: var(--mono); font-size: 0.78rem; color: var(--muted);
  letter-spacing: 0.08em;
}
.card-note {
  font-size: 0.72rem; color: var(--muted); margin-top: 4px;
  font-style: italic;
}

/* ── GAUGE ── */
.section-title {
  font-family: var(--en); font-size: 0.8rem; font-weight: 700;
  color: var(--muted); letter-spacing: 0.2em; text-transform: uppercase;
  margin-bottom: 16px; display: flex; align-items: center; gap: 10px;
}
.section-title::after {
  content: ''; flex: 1; height: 1px; background: var(--border);
}
.gauges-grid {
  display: flex; flex-direction: column; gap: 16px;
  margin-bottom: 32px;
}
.gauge-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 22px 26px;
  backdrop-filter: blur(24px);
  transition: all 0.3s cubic-bezier(0.16,1,0.3,1);
}
.gauge-card:hover { border-color: rgba(255,255,255,0.18); }
.gauge-header {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 14px;
}
.gauge-name {
  font-family: var(--en); font-size: 0.82rem; font-weight: 700;
  color: var(--text); letter-spacing: 0.1em;
}
.gauge-limit {
  font-family: var(--mono); font-size: 0.75rem; color: var(--muted);
}
.gauge-bar-wrap {
  width: 100%; height: 8px; background: rgba(255,255,255,0.06);
  border-radius: 4px; overflow: hidden; margin-bottom: 10px;
}
.gauge-bar {
  height: 100%; border-radius: 4px;
  transition: width 1s cubic-bezier(0.16,1,0.3,1), background 0.5s;
  min-width: 2px;
}
.gauge-bar.safe { background: linear-gradient(90deg, var(--green), #34d399); }
.gauge-bar.warn { background: linear-gradient(90deg, var(--yellow), #fbbf24); box-shadow: 0 0 8px rgba(245,158,11,0.4); }
.gauge-bar.danger { background: linear-gradient(90deg, var(--red), #f87171); box-shadow: 0 0 8px rgba(239,68,68,0.4); }
.gauge-footer {
  display: flex; align-items: center; justify-content: space-between;
}
.gauge-vals {
  font-family: var(--mono); font-size: 0.8rem; color: var(--text);
}
.gauge-pct {
  font-family: var(--en); font-size: 0.8rem; font-weight: 700;
  color: var(--muted);
}
.gauge-tag {
  font-size: 0.68rem; padding: 3px 8px; border-radius: 6px;
  font-family: var(--en); font-weight: 700; letter-spacing: 0.08em;
}
.tag-estimated { background: rgba(6,182,212,0.15); color: var(--cyan); border: 1px solid rgba(6,182,212,0.3); }
.tag-session { background: rgba(16,185,129,0.15); color: var(--green); border: 1px solid rgba(16,185,129,0.3); }
.tag-live { background: rgba(225,29,72,0.15); color: #fb7185; border: 1px solid rgba(225,29,72,0.3); }

/* ── CONSOLE LOG ── */
.log-card {
  background: rgba(9,9,11,0.9);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 20px;
  font-family: var(--mono);
  font-size: 0.78rem;
  max-height: 200px;
  overflow-y: auto;
  margin-bottom: 32px;
}
.log-card::-webkit-scrollbar { width: 4px; }
.log-card::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 2px; }
.log-line { color: var(--muted); line-height: 1.7; }
.log-line .ts { color: rgba(255,255,255,0.25); margin-right: 8px; }
.log-line .ok { color: var(--green); }
.log-line .warn { color: var(--yellow); }
.log-line .err { color: var(--red); }

/* ── FOOTER ── */
.footer {
  text-align: center;
  font-family: var(--mono); font-size: 0.72rem;
  color: rgba(255,255,255,0.2); letter-spacing: 0.1em;
  line-height: 2;
}
.footer a { color: var(--cyan); text-decoration: none; }
.footer a:hover { text-decoration: underline; }

/* ── LOADING ── */
.loading-val { opacity: 0.3; animation: blink 1.2s ease-in-out infinite; }
@keyframes blink { 0%,100%{opacity:0.3;} 50%{opacity:0.7;} }

@media (max-width: 600px) {
  .container { padding: 24px 16px 60px; }
  .card-value { font-size: 2.2rem; }
  .room-size { display: none; }
}
</style>
</head>
<body>

<div class="container">

  <div class="header">
    <div class="logo-wrap">
      <div class="logo">Q-ROOM</div>
      <div class="logo-tag">MONITOR</div>
    </div>
    <div class="status-row">
      <div class="dot" id="dot"></div>
      <div class="status-text" id="status-text">CONNECTING...</div>
      <div class="next-refresh" id="next-refresh"></div>
    </div>
  </div>

  <div class="disclaimer">
    <strong>⚠ 計測について：</strong>
    「推定ストレージ」は現在の <code>/rooms/</code> データのJSONサイズです。Firebase の正確な累計ダウンロード量・全体read数は
    <a href="https://console.firebase.google.com/project/q-room-fe8a6/usage" target="_blank" style="color:var(--yellow)">Firebase Console → 使用状況</a>
    で確認してください。セッションread数はこのページを開いてからの取得回数です。
  </div>

  <div id="error-box" style="display:none;background:rgba(239,68,68,0.12);border:1px solid rgba(239,68,68,0.5);border-radius:14px;padding:18px 22px;margin-bottom:24px;">
    <div style="font-family:var(--en);font-size:0.8rem;font-weight:700;color:var(--red);letter-spacing:0.15em;margin-bottom:8px;">❌ ERROR</div>
    <div id="error-msg" style="font-family:var(--mono);font-size:0.82rem;color:#fca5a5;line-height:1.7;"></div>
    <div style="margin-top:12px;font-size:0.78rem;color:var(--muted);line-height:1.7;">
      よくある原因：<br>
      ① Firebase セキュリティルールで <code>/rooms</code> への読み取りが拒否されている<br>
      ② ネットワーク接続の問題（VPN・ファイアウォール等）<br>
      ③ ローカルファイルとして開いている場合、Firebaseが接続できないことがある
    </div>
  </div>

  <div class="cards-grid">
    <div class="card">
      <div class="card-label"><span class="card-label-dot" style="background:var(--cyan);box-shadow:0 0 6px var(--cyan)"></span>アクティブルーム</div>
      <div class="card-value loading-val" id="val-rooms" style="color:var(--cyan)">—</div>
      <div class="card-sub" id="sub-rooms">取得中...</div>
    </div>
    <div class="card">
      <div class="card-label"><span class="card-label-dot" style="background:var(--green);box-shadow:0 0 6px var(--green)"></span>アクティブプレイヤー</div>
      <div class="card-value loading-val" id="val-players" style="color:var(--green)">—</div>
      <div class="card-sub" id="sub-players">取得中...</div>
    </div>
    <div class="card">
      <div class="card-label"><span class="card-label-dot" style="background:var(--yellow);box-shadow:0 0 6px var(--yellow)"></span>推定ストレージ</div>
      <div class="card-value loading-val" id="val-storage" style="color:var(--yellow)">—</div>
      <div class="card-sub" id="sub-storage">/ 1 GB 無料枠</div>
    </div>
    <div class="card">
      <div class="card-label"><span class="card-label-dot" style="background:var(--magenta);box-shadow:0 0 6px var(--magenta)"></span>接続数 (推定)</div>
      <div class="card-value loading-val" id="val-conns" style="color:#fb7185">—</div>
      <div class="card-sub" id="sub-conns">/ 100 同時接続 無料枠</div>
    </div>
    <div class="card">
      <div class="card-label"><span class="card-label-dot" style="background:#8b5cf6;box-shadow:0 0 6px #8b5cf6"></span>Sessionリード数</div>
      <div class="card-value" id="val-reads" style="color:#a78bfa">0</div>
      <div class="card-sub">このページを開いてから</div>
      <div class="card-note">Firebase全体ではありません</div>
    </div>
    <div class="card">
      <div class="card-label"><span class="card-label-dot" style="background:var(--orange);box-shadow:0 0 6px var(--orange)"></span>最終更新</div>
      <div class="card-value" id="val-time" style="color:var(--orange);font-size:1.6rem;letter-spacing:-0.01em">—:—:—</div>
      <div class="card-sub" id="sub-time">60秒ごとに自動更新</div>
    </div>
  </div>

  <div class="section-title">無料枠ゲージ</div>
  <div class="gauges-grid">
    <div class="gauge-card">
      <div class="gauge-header">
        <div class="gauge-name">STORAGE （推定）</div>
        <div style="display:flex;gap:8px;align-items:center;">
          <span class="gauge-tag tag-estimated">ESTIMATED</span>
          <div class="gauge-limit" id="gauge-storage-limit">0 KB / 1 GB</div>
        </div>
      </div>
      <div class="gauge-bar-wrap"><div class="gauge-bar safe" id="bar-storage" style="width:0%"></div></div>
      <div class="gauge-footer">
        <div class="gauge-vals" id="gauge-storage-vals">—</div>
        <div class="gauge-pct" id="gauge-storage-pct">0%</div>
      </div>
    </div>
    <div class="gauge-card">
      <div class="gauge-header">
        <div class="gauge-name">SIMULTANEOUS CONNECTIONS</div>
        <div style="display:flex;gap:8px;align-items:center;">
          <span class="gauge-tag tag-live">LIVE</span>
          <div class="gauge-limit" id="gauge-conn-limit">— / 100</div>
        </div>
      </div>
      <div class="gauge-bar-wrap"><div class="gauge-bar safe" id="bar-conn" style="width:0%"></div></div>
      <div class="gauge-footer">
        <div class="gauge-vals" id="gauge-conn-vals">—</div>
        <div class="gauge-pct" id="gauge-conn-pct">0%</div>
      </div>
    </div>
    <div class="gauge-card">
      <div class="gauge-header">
        <div class="gauge-name">SESSION READS</div>
        <div style="display:flex;gap:8px;align-items:center;">
          <span class="gauge-tag tag-session">THIS SESSION</span>
          <div class="gauge-limit" id="gauge-reads-limit">—</div>
        </div>
      </div>
      <div class="gauge-bar-wrap"><div class="gauge-bar safe" id="bar-reads" style="width:0%"></div></div>
      <div class="gauge-footer">
        <div class="gauge-vals" id="gauge-reads-vals">—</div>
        <div class="gauge-pct" id="gauge-reads-pct">—</div>
      </div>
    </div>
  </div>

  <div class="section-title">ログ</div>
  <div class="log-card" id="log"></div>

  <div class="footer">
    Q-Room Monitor &nbsp;·&nbsp; Firebase Realtime Database &nbsp;·&nbsp; Project: q-room-fe8a6<br>
    正確な使用量は
    <a href="https://console.firebase.google.com/project/q-room-fe8a6/usage" target="_blank">Firebase Console</a>
    &nbsp;/&nbsp;
    <a href="https://console.firebase.google.com/project/q-room-fe8a6/database/q-room-fe8a6-default-rtdb/data" target="_blank">Realtime Database</a>
    で確認してください。
  </div>

</div>

<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyA3xtGLVJwij2BTiiOk7DsNeF9hIOuZCyI",
  authDomain: "q-room-fe8a6.firebaseapp.com",
  databaseURL: "https://q-room-fe8a6-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "q-room-fe8a6",
  storageBucket: "q-room-fe8a6.firebasestorage.app",
  messagingSenderId: "151049149394",
  appId: "1:151049149394:web:7a3ea6406454f6a87d460b"
};

const STORAGE_LIMIT_BYTES = 1 * 1024 * 1024 * 1024;
const CONN_LIMIT = 100;

let db = null;
let sessionReads = 0;
let refreshTimer = null;
let countdownTimer = null;
let countdownSec = 60;
let isConnected = false;

function initFB() {
  try {
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    db = firebase.database();

    db.ref('.info/connected').on('value', snap => {
      isConnected = snap.val() === true;
      document.getElementById('dot').className = 'dot' + (isConnected ? '' : ' offline');
      document.getElementById('status-text').textContent = isConnected ? 'CONNECTED' : 'DISCONNECTED';
    });
  } catch(e) {
    addLog('err', 'Firebase初期化失敗: ' + e.message);
  }
}

function formatBytes(bytes) {
  if (bytes === 0) return '0 B';
  if (bytes < 1024) return bytes + ' B';
  if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
  if (bytes < 1024 * 1024 * 1024) return (bytes / 1024 / 1024).toFixed(2) + ' MB';
  return (bytes / 1024 / 1024 / 1024).toFixed(3) + ' GB';
}

function getBarClass(pct) {
  if (pct >= 90) return 'danger';
  if (pct >= 70) return 'warn';
  return 'safe';
}

function setGauge(barId, pctId, valsId, limitId, value, limit, valueStr, limitStr) {
  const pct = Math.min(100, (value / limit) * 100);
  const bar = document.getElementById(barId);
  bar.style.width = Math.max(pct, 0.3) + '%';
  bar.className = 'gauge-bar ' + getBarClass(pct);
  document.getElementById(pctId).textContent = pct.toFixed(2) + '%';
  document.getElementById(valsId).textContent = valueStr + ' / ' + limitStr;
  document.getElementById(limitId).textContent = valueStr + ' / ' + limitStr;
}

function addLog(type, msg) {
  const el = document.getElementById('log');
  const now = new Date();
  const ts = String(now.getHours()).padStart(2,'0') + ':' +
              String(now.getMinutes()).padStart(2,'0') + ':' +
              String(now.getSeconds()).padStart(2,'0');
  const line = document.createElement('div');
  line.className = 'log-line';
  line.innerHTML = `<span class="ts">[${ts}]</span><span class="${type}">${msg}</span>`;
  el.appendChild(line);
  el.scrollTop = el.scrollHeight;
}

function setLoading(on) {
  ['val-rooms','val-players','val-storage','val-conns'].forEach(id => {
    const el = document.getElementById(id);
    if (on) { el.classList.add('loading-val'); el.textContent = '—'; }
    else { el.classList.remove('loading-val'); }
  });
}

const RULE_LABELS = {
  survival:'サバイバル', free:'フリー', newyork:'NY', rentou:'連答',
  updown:'UD', by:'BY', freeze:'フリーズ', m_n_rest:'MNR',
  swedish:'スウェ', ren_wrong:'連誤', divide:'分配', combo:'コンボ',
  attack_surv:'攻撃', lucky:'ラッキー', spiral:'スパイラル', time_race:'タイムレース'
};

async function fetchData() {
  if (!db) return;
  setLoading(true);
  addLog('ok', 'データ取得開始...');

  try {
    const snap = await db.ref('rooms').once('value');
    sessionReads++;

    const roomsData = snap.val() || {};
    const roomKeys = Object.keys(roomsData);

    const jsonStr = JSON.stringify(roomsData);
    const storageBytes = new TextEncoder().encode(jsonStr).length;

    let totalPlayers = 0;
    let activeRooms = 0;
    const ACTIVE_THRESHOLD_MS = 30 * 60 * 1000;
    const now_ms = Date.now();

    roomKeys.forEach(rid => {
      const room = roomsData[rid];
      const lastActive = room.lastActiveAt || room.createdAt || 0;
      if ((now_ms - lastActive) >= ACTIVE_THRESHOLD_MS) return;

      const players = room.players || {};
      const activePlayers = Object.values(players).filter(p => {
        const playerTs = p.statsAt || p.joined || 0;
        return (now_ms - playerTs) < ACTIVE_THRESHOLD_MS;
      });
      const pCount = activePlayers.length;

      if (pCount > 0 && room.status !== 'finished') {
        activeRooms++;
        totalPlayers += pCount;
      }
    });

    document.getElementById('val-rooms').textContent = activeRooms;
    document.getElementById('sub-rooms').textContent = `合計 ${roomKeys.length} 部屋中 / 30分以内にアクティブ`;

    document.getElementById('val-players').textContent = totalPlayers;
    document.getElementById('sub-players').textContent = `${activeRooms} 部屋に参加中（30分以内）`;

    document.getElementById('val-storage').textContent = formatBytes(storageBytes);
    document.getElementById('sub-storage').textContent = '/ 1 GB 無料枠（/rooms/ のみ）';

    const estimatedConns = totalPlayers + (activeRooms > 0 ? 1 : 0);
    document.getElementById('val-conns').textContent = estimatedConns;
    document.getElementById('sub-conns').textContent = `/ 100 同時接続 無料枠`;

    document.getElementById('val-reads').textContent = sessionReads;

    const now = new Date();
    document.getElementById('val-time').textContent =
      String(now.getHours()).padStart(2,'0') + ':' +
      String(now.getMinutes()).padStart(2,'0') + ':' +
      String(now.getSeconds()).padStart(2,'0');
    document.getElementById('sub-time').textContent = '60秒ごとに自動更新';

    setGauge('bar-storage','gauge-storage-pct','gauge-storage-vals','gauge-storage-limit',
      storageBytes, STORAGE_LIMIT_BYTES, formatBytes(storageBytes), '1 GB');

    setGauge('bar-conn','gauge-conn-pct','gauge-conn-vals','gauge-conn-limit',
      estimatedConns, CONN_LIMIT, estimatedConns + '接続', '100');

    const readsPct = Math.min(sessionReads, 100);
    document.getElementById('bar-reads').style.width = readsPct + '%';
    document.getElementById('bar-reads').className = 'gauge-bar ' + getBarClass(readsPct);
    document.getElementById('gauge-reads-pct').textContent = sessionReads + ' reads';
    document.getElementById('gauge-reads-vals').textContent = sessionReads + ' reads (このセッション)';
    document.getElementById('gauge-reads-limit').textContent = sessionReads + ' reads';

    addLog('ok', `取得完了 — ${activeRooms}室アクティブ / ${totalPlayers}プレイヤー / ${formatBytes(storageBytes)} / ${sessionReads}reads`);

    if (storageBytes / STORAGE_LIMIT_BYTES > 0.7) {
      addLog('warn', 'ストレージ使用率 70% 超。Firebase Consoleで確認を推奨します。');
    }
    if (estimatedConns > 70) {
      addLog('warn', `接続数が ${estimatedConns} / 100 に達しています。`);
    }

  } catch(e) {
    const errBox = document.getElementById('error-box');
    const errMsg = document.getElementById('error-msg');
    errBox.style.display = 'block';
    const msg = e.message || String(e);
    errMsg.innerHTML = `<strong>${msg}</strong>`;

    if (msg.includes('permission') || msg.includes('PERMISSION_DENIED')) {
      errMsg.innerHTML += '<br><br>→ Firebase セキュリティルールが読み取りを拒否しています。<br>' +
        '<a href="https://console.firebase.google.com/project/q-room-fe8a6/database/q-room-fe8a6-default-rtdb/rules" target="_blank" style="color:var(--cyan)">ルール設定を確認する</a>';
    }

    addLog('err', '取得失敗: ' + msg);
    document.getElementById('status-text').textContent = 'ERROR';
    setLoading(false);
    ['val-rooms','val-players','val-storage','val-conns'].forEach(id => {
      document.getElementById(id).textContent = 'ERR';
      document.getElementById(id).style.color = 'var(--red)';
    });
  }
}

function startCountdown() {
  clearInterval(countdownTimer);
  countdownSec = 60;
  countdownTimer = setInterval(() => {
    countdownSec--;
    document.getElementById('next-refresh').textContent = `NEXT: ${countdownSec}s`;
    if (countdownSec <= 0) {
      clearInterval(countdownTimer);
      fetchData();
      setTimeout(startCountdown, 500);
    }
  }, 1000);
}

window.addEventListener('load', () => {
  initFB();
  addLog('ok', 'Q-Room Monitor 起動');
  addLog('warn', '注意: セッションreadカウントはこのページの取得のみ。Firebase全体の数値ではありません。');
  fetchData().then(() => startCountdown());
});
</script>
</body>
</html>