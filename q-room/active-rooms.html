<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Q-Room | Active Rooms</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --bg: #09090b;
  --surface: rgba(24,24,27,0.75);
  --border: rgba(255,255,255,0.1);
  --cyan: #06b6d4;
  --magenta: #e11d48;
  --green: #10b981;
  --red: #ef4444;
  --yellow: #f59e0b;
  --text: #f4f4f5;
  --muted: #a1a1aa;
  --en: 'Inter', sans-serif;
  --ja: 'Noto Sans JP', sans-serif;
  --mono: 'JetBrains Mono', monospace;
}
html, body {
  min-height: 100vh;
  background-color: var(--bg);
  background-image:
    radial-gradient(circle at 15% 20%, rgba(6,182,212,0.07) 0%, transparent 45%),
    radial-gradient(circle at 85% 80%, rgba(225,29,72,0.07) 0%, transparent 45%);
  color: var(--text);
  font-family: var(--ja);
}
.container {
  max-width: 860px;
  margin: 0 auto;
  padding: 40px 24px 80px;
}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 40px;
  gap: 16px;
  flex-wrap: wrap;
}
.logo-wrap { display: flex; align-items: baseline; gap: 12px; }
.logo {
  font-family: var(--en); font-size: 2rem; font-weight: 900;
  background: linear-gradient(135deg, #fff, var(--cyan));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  letter-spacing: 0.08em;
  filter: drop-shadow(0 4px 16px rgba(6,182,212,0.4));
}
.logo-tag {
  font-family: var(--mono); font-size: 0.75rem; color: var(--muted);
  background: rgba(255,255,255,0.06); border: 1px solid var(--border);
  border-radius: 6px; padding: 4px 10px; letter-spacing: 0.15em;
}
.status-row { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
.dot {
  width: 8px; height: 8px; border-radius: 50%;
  background: var(--green); box-shadow: 0 0 8px var(--green);
  animation: pulse 2s ease-in-out infinite; flex-shrink: 0;
}
.dot.offline { background: var(--red); box-shadow: 0 0 8px var(--red); animation: none; }
@keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.4;} }
.status-text { font-family: var(--mono); font-size: 0.8rem; color: var(--muted); letter-spacing: 0.1em; }
.countdown-text { font-family: var(--mono); font-size: 0.8rem; color: var(--muted); }

/* ‚îÄ‚îÄ SUMMARY BAR ‚îÄ‚îÄ */
.summary-bar {
  display: flex; gap: 16px; margin-bottom: 28px; flex-wrap: wrap;
}
.summary-chip {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 12px; padding: 12px 20px;
  display: flex; flex-direction: column; gap: 4px;
  backdrop-filter: blur(16px);
  flex: 1; min-width: 120px;
}
.chip-label { font-family: var(--en); font-size: 0.68rem; font-weight: 700; color: var(--muted); letter-spacing: 0.18em; text-transform: uppercase; }
.chip-val { font-family: var(--en); font-size: 1.6rem; font-weight: 900; line-height: 1; }

/* ‚îÄ‚îÄ ROOM CARDS ‚îÄ‚îÄ */
.rooms-list { display: flex; flex-direction: column; gap: 16px; }

.room-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 20px;
  backdrop-filter: blur(24px);
  overflow: hidden;
  transition: all 0.3s cubic-bezier(0.16,1,0.3,1);
  animation: fadeUp 0.5s cubic-bezier(0.16,1,0.3,1) both;
}
@keyframes fadeUp { from { opacity:0; transform: translateY(12px); } to { opacity:1; transform: translateY(0); } }
.room-card:hover { transform: translateY(-3px); box-shadow: 0 12px 32px rgba(0,0,0,0.4); border-color: rgba(255,255,255,0.18); }
.room-card.finished { opacity: 0.5; filter: grayscale(60%); }

.room-card-header {
  display: flex; align-items: center; gap: 14px;
  padding: 20px 24px 16px;
  border-bottom: 1px solid var(--border);
  flex-wrap: wrap; gap: 10px;
}
.room-id-wrap { display: flex; align-items: center; gap: 10px; flex: 1; }
.live-dot {
  width: 8px; height: 8px; border-radius: 50%;
  background: var(--green); box-shadow: 0 0 6px var(--green);
  animation: pulse 2s ease-in-out infinite; flex-shrink: 0;
}
.live-dot.fin { background: var(--muted); box-shadow: none; animation: none; }
.room-id-label { font-family: var(--mono); font-size: 0.7rem; color: var(--muted); letter-spacing: 0.15em; }
.room-id-val { font-family: var(--mono); font-size: 1.4rem; font-weight: 700; color: var(--cyan); letter-spacing: 0.12em; }

.copy-btn {
  background: rgba(6,182,212,0.1); border: 1px solid rgba(6,182,212,0.3);
  border-radius: 10px; padding: 7px 14px;
  font-family: var(--mono); font-size: 0.72rem; font-weight: 700;
  color: var(--cyan); cursor: pointer; transition: 0.25s;
  letter-spacing: 0.08em; white-space: nowrap; flex-shrink: 0;
}
.copy-btn:hover { background: rgba(6,182,212,0.2); border-color: var(--cyan); transform: translateY(-1px); }
.copy-btn.copied { background: rgba(16,185,129,0.15); border-color: rgba(16,185,129,0.5); color: var(--green); }

.join-btn {
  background: linear-gradient(135deg, var(--cyan), #0284c7);
  border: none; border-radius: 10px; padding: 7px 16px;
  font-family: var(--mono); font-size: 0.72rem; font-weight: 700;
  color: #fff; cursor: pointer; transition: 0.25s;
  letter-spacing: 0.08em; white-space: nowrap; flex-shrink: 0;
  box-shadow: 0 4px 12px rgba(6,182,212,0.3);
}
.join-btn:hover { box-shadow: 0 6px 18px rgba(6,182,212,0.45); transform: translateY(-1px); }

.ghost-btn {
  background: rgba(225,29,72,0.08); border: 1px solid rgba(225,29,72,0.25);
  border-radius: 10px; padding: 7px 14px;
  font-family: var(--mono); font-size: 0.72rem; font-weight: 700;
  color: rgba(251,113,133,0.8); cursor: pointer; transition: 0.25s;
  letter-spacing: 0.08em; white-space: nowrap; flex-shrink: 0;
}
.ghost-btn:hover { background: rgba(225,29,72,0.18); border-color: rgba(225,29,72,0.5); transform: translateY(-1px); }
  background: rgba(225,29,72,0.1); border: 1px solid rgba(225,29,72,0.3);
  border-radius: 10px; padding: 7px 14px;
  font-family: var(--mono); font-size: 0.72rem; font-weight: 700;
  color: #fb7185; cursor: pointer; transition: 0.25s;
  letter-spacing: 0.08em; white-space: nowrap; flex-shrink: 0;
}
.peek-btn:hover { background: rgba(225,29,72,0.2); border-color: var(--magenta); transform: translateY(-1px); }

/* ‚îÄ‚îÄ ADMIN BADGE ‚îÄ‚îÄ */
.admin-badge {
  font-family: var(--mono); font-size: 0.72rem; font-weight: 700;
  color: var(--yellow); background: rgba(245,158,11,0.15);
  border: 1px solid rgba(245,158,11,0.4); border-radius: 8px;
  padding: 4px 10px; letter-spacing: 0.12em;
}

/* ‚îÄ‚îÄ PEEK OVERLAY / DRAWER ‚îÄ‚îÄ */
.peek-overlay {
  display: none; position: fixed; inset: 0;
  background: rgba(0,0,0,0.55); backdrop-filter: blur(4px);
  z-index: 900;
}
.peek-overlay.show { display: block; }

.peek-drawer {
  position: fixed; top: 0; right: 0; bottom: 0;
  width: 100%; max-width: 440px;
  background: #111113; border-left: 1px solid rgba(255,255,255,0.12);
  z-index: 1000; display: flex; flex-direction: column;
  transform: translateX(100%); transition: transform 0.35s cubic-bezier(0.16,1,0.3,1);
  box-shadow: -12px 0 40px rgba(0,0,0,0.5);
}
.peek-drawer.open { transform: translateX(0); }

.peek-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 20px 24px; border-bottom: 1px solid rgba(255,255,255,0.1);
  flex-shrink: 0;
}
.peek-title {
  font-family: var(--en); font-size: 0.75rem; font-weight: 700;
  color: var(--magenta); letter-spacing: 0.2em; text-transform: uppercase;
  margin-bottom: 4px;
}
.peek-rid {
  font-family: var(--mono); font-size: 1rem; font-weight: 700; color: var(--cyan);
  letter-spacing: 0.12em;
}
.peek-close {
  background: rgba(255,255,255,0.07); border: 1px solid var(--border);
  border-radius: 8px; width: 34px; height: 34px;
  font-size: 1rem; color: var(--muted); cursor: pointer; transition: 0.2s;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
}
.peek-close:hover { background: rgba(255,255,255,0.14); color: var(--text); }

.peek-body {
  flex: 1; overflow-y: auto; padding: 20px 24px;
  scrollbar-width: thin; scrollbar-color: rgba(255,255,255,0.15) transparent;
}
.peek-body::-webkit-scrollbar { width: 5px; }
.peek-body::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 3px; }

.peek-footer {
  padding: 12px 24px; border-top: 1px solid rgba(255,255,255,0.08);
  font-family: var(--mono); font-size: 0.65rem;
  color: rgba(255,255,255,0.25); letter-spacing: 0.08em;
  flex-shrink: 0;
}

.peek-section { margin-bottom: 20px; }
.peek-section-title {
  font-family: var(--en); font-size: 0.68rem; font-weight: 700;
  color: var(--muted); letter-spacing: 0.2em; text-transform: uppercase;
  margin-bottom: 10px; display: flex; align-items: center; gap: 8px;
}
.peek-live-dot {
  width: 7px; height: 7px; background: var(--green);
  box-shadow: 0 0 6px var(--green); animation: pulse 2s ease-in-out infinite;
}

.peek-kv {
  display: flex; justify-content: space-between; align-items: center;
  padding: 7px 0; border-bottom: 1px solid rgba(255,255,255,0.05);
  font-family: var(--mono); font-size: 0.78rem;
}
.peek-kv:last-child { border-bottom: none; }
.peek-key { color: var(--muted); font-size: 0.72rem; letter-spacing: 0.1em; }
.peek-val { color: var(--text); font-weight: 700; }

.peek-player-row {
  display: flex; align-items: center; gap: 10px;
  padding: 8px 10px; border-radius: 10px; margin-bottom: 6px;
  background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.06);
  transition: 0.2s;
}
.peek-player-row:hover { background: rgba(255,255,255,0.07); }
.peek-player-row.win { background: rgba(16,185,129,0.07); border-color: rgba(16,185,129,0.25); }
.peek-player-row.lose { opacity: 0.45; filter: grayscale(70%); }

.peek-avatar {
  width: 26px; height: 26px; border-radius: 50%; font-size: 0.72rem; font-weight: 700;
  display: flex; align-items: center; justify-content: center;
  background: rgba(6,182,212,0.2); color: var(--cyan);
  font-family: var(--en); flex-shrink: 0;
}
.peek-avatar.win { background: rgba(16,185,129,0.2); color: var(--green); }

.peek-pname { flex: 1; font-weight: 700; font-size: 0.88rem; }
.peek-stats {
  display: flex; gap: 8px; font-family: var(--mono); font-size: 0.75rem; color: var(--muted);
}
.peek-stats .sc { color: var(--cyan); font-weight: 700; }
.peek-stats .sc.win { color: var(--green); }

/* ‚îÄ‚îÄ SITE GATE ‚îÄ‚îÄ */
.gate-overlay {
  display: none; position: fixed; inset: 0;
  background: var(--bg); z-index: 9999;
  align-items: center; justify-content: center;
  background-image:
    radial-gradient(circle at 20% 30%, rgba(6,182,212,0.07) 0%, transparent 50%),
    radial-gradient(circle at 80% 70%, rgba(225,29,72,0.07) 0%, transparent 50%);
}
.gate-overlay.show { display: flex; }
.gate-box {
  background: rgba(24,24,27,0.9); border: 1px solid rgba(255,255,255,0.12);
  border-radius: 24px; padding: 40px 36px; width: 100%; max-width: 380px;
  box-shadow: 0 32px 80px rgba(0,0,0,0.7);
  animation: fadeUp 0.4s cubic-bezier(0.16,1,0.3,1) both;
  backdrop-filter: blur(24px);
}
.gate-logo {
  font-family: var(--en); font-size: 1.8rem; font-weight: 900;
  background: linear-gradient(135deg, #fff, var(--cyan));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  letter-spacing: 0.08em; margin-bottom: 4px;
  filter: drop-shadow(0 4px 16px rgba(6,182,212,0.4));
}
.gate-sub {
  font-family: var(--mono); font-size: 0.75rem; color: var(--muted);
  letter-spacing: 0.12em; margin-bottom: 28px;
}
.gate-input {
  width: 100%; background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.15); border-radius: 12px;
  padding: 13px 16px; font-family: var(--mono); font-size: 0.95rem;
  color: var(--text); outline: none; transition: 0.25s; margin-bottom: 10px;
}
.gate-input:focus { border-color: rgba(6,182,212,0.5); box-shadow: 0 0 0 3px rgba(6,182,212,0.1); }
.gate-error {
  font-family: var(--mono); font-size: 0.75rem; color: var(--red);
  min-height: 1.3em; margin-bottom: 14px; padding-left: 2px;
}
.gate-btn {
  width: 100%; background: linear-gradient(135deg, var(--cyan), #0284c7);
  border: none; border-radius: 12px; padding: 12px 0;
  font-family: var(--mono); font-size: 0.85rem; font-weight: 700;
  color: #fff; cursor: pointer; transition: 0.25s; letter-spacing: 0.1em;
  box-shadow: 0 4px 16px rgba(6,182,212,0.35);
}
.gate-btn:hover { box-shadow: 0 6px 22px rgba(6,182,212,0.5); transform: translateY(-1px); }

.rule-badge {
  font-size: 0.72rem; padding: 5px 12px; border-radius: 8px;
  background: rgba(225,29,72,0.15); border: 1px solid rgba(225,29,72,0.3);
  color: #fb7185; font-weight: 700; font-family: var(--en); letter-spacing: 0.05em;
  white-space: nowrap;
}

/* ‚îÄ‚îÄ ROOM META ROW ‚îÄ‚îÄ */
.room-meta {
  display: flex; gap: 24px; padding: 12px 24px;
  border-bottom: 1px solid var(--border);
  font-family: var(--mono); font-size: 0.75rem; color: var(--muted);
  flex-wrap: wrap; gap: 16px;
}
.meta-item { display: flex; align-items: center; gap: 6px; }
.meta-item svg { width: 13px; height: 13px; stroke: currentColor; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; flex-shrink: 0; }
.meta-item span { color: var(--text); font-weight: 700; }

/* ‚îÄ‚îÄ PLAYER LIST ‚îÄ‚îÄ */
.players-wrap { padding: 14px 24px 20px; }
.players-title {
  font-family: var(--en); font-size: 0.68rem; font-weight: 700;
  color: var(--muted); letter-spacing: 0.2em; text-transform: uppercase;
  margin-bottom: 12px;
}
.players-grid {
  display: flex; flex-wrap: wrap; gap: 8px;
}
.player-chip {
  display: flex; align-items: center; gap: 7px;
  background: rgba(255,255,255,0.05); border: 1px solid var(--border);
  border-radius: 10px; padding: 7px 13px;
  font-size: 0.85rem; transition: 0.2s;
}
.player-chip:hover { border-color: rgba(255,255,255,0.2); background: rgba(255,255,255,0.08); }
.player-chip.st-active { border-color: rgba(6,182,212,0.3); }
.player-chip.st-win { border-color: rgba(16,185,129,0.4); background: rgba(16,185,129,0.07); }
.player-chip.st-lose { opacity: 0.45; filter: grayscale(80%); }
.player-chip.st-spec { opacity: 0.5; border-style: dashed; }
.player-avatar {
  width: 22px; height: 22px; border-radius: 50%; font-size: 0.7rem; font-weight: 700;
  display: flex; align-items: center; justify-content: center;
  background: rgba(6,182,212,0.2); color: var(--cyan); flex-shrink: 0;
  font-family: var(--en);
}
.player-avatar.win { background: rgba(16,185,129,0.2); color: var(--green); }
.player-name { font-weight: 700; font-size: 0.88rem; }
.player-score { font-family: var(--mono); font-size: 0.78rem; color: var(--muted); margin-left: 2px; }
.player-sc-val { color: var(--cyan); font-weight: 700; }
.player-sc-val.win { color: var(--green); }

/* ‚îÄ‚îÄ EMPTY / ERROR ‚îÄ‚îÄ */
.empty {
  text-align: center; padding: 80px 24px;
  font-family: var(--mono); color: var(--muted);
}
.empty-icon { font-size: 3rem; margin-bottom: 16px; opacity: 0.5; }
.empty-text { font-size: 0.85rem; letter-spacing: 0.1em; }

.error-box {
  background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.4);
  border-radius: 14px; padding: 20px 24px; margin-bottom: 24px;
  display: none;
}
.error-title { font-family: var(--en); font-size: 0.78rem; font-weight: 700; color: var(--red); letter-spacing: 0.15em; margin-bottom: 8px; }
.error-msg { font-family: var(--mono); font-size: 0.8rem; color: #fca5a5; line-height: 1.7; }

/* ‚îÄ‚îÄ SECTION TITLE ‚îÄ‚îÄ */
.section-title {
  font-family: var(--en); font-size: 0.78rem; font-weight: 700;
  color: var(--muted); letter-spacing: 0.2em; text-transform: uppercase;
  margin-bottom: 18px; display: flex; align-items: center; gap: 10px;
}
.section-title::after { content: ''; flex: 1; height: 1px; background: var(--border); }
.section-count {
  font-family: var(--mono); font-size: 0.8rem; color: var(--cyan);
  background: rgba(6,182,212,0.1); border: 1px solid rgba(6,182,212,0.25);
  border-radius: 8px; padding: 3px 10px;
}

/* ‚îÄ‚îÄ DATE GROUP ‚îÄ‚îÄ */
.date-group { margin-bottom: 8px; }
.date-group-toggle {
  display: flex; align-items: center; gap: 10px;
  width: 100%; background: rgba(255,255,255,0.04);
  border: 1px solid var(--border); border-radius: 12px;
  padding: 10px 18px; cursor: pointer; transition: 0.25s;
  color: var(--text); text-align: left; margin-bottom: 10px;
}
.date-group-toggle:hover { border-color: rgba(255,255,255,0.2); background: rgba(255,255,255,0.07); }
.date-group-toggle.open { border-color: rgba(6,182,212,0.3); background: rgba(6,182,212,0.06); }
.date-group-arrow { font-family: var(--mono); font-size: 0.72rem; color: var(--muted); flex-shrink: 0; }
.date-group-label { font-family: var(--mono); font-size: 0.82rem; font-weight: 700; flex: 1; letter-spacing: 0.08em; }
.date-group-count { font-family: var(--mono); font-size: 0.7rem; color: var(--muted); background: rgba(255,255,255,0.07); border: 1px solid var(--border); border-radius: 6px; padding: 3px 9px; flex-shrink: 0; }

/* ‚îÄ‚îÄ FINISHED SECTION ‚îÄ‚îÄ */
.finished-toggle {
  background: none; border: 1px solid var(--border); border-radius: 12px;
  color: var(--muted); font-family: var(--mono); font-size: 0.75rem;
  padding: 9px 18px; cursor: pointer; transition: 0.25s; letter-spacing: 0.08em;
  margin-bottom: 20px;
}
.finished-toggle:hover { border-color: rgba(255,255,255,0.25); color: var(--text); }

/* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
.footer {
  text-align: center; margin-top: 48px;
  font-family: var(--mono); font-size: 0.7rem;
  color: rgba(255,255,255,0.18); letter-spacing: 0.1em; line-height: 2;
}
.footer a { color: var(--cyan); text-decoration: none; }
.footer a:hover { text-decoration: underline; }

.loading-shimmer { opacity: 0.35; animation: blink 1.2s ease-in-out infinite; }
@keyframes blink { 0%,100%{opacity:0.35;} 50%{opacity:0.7;} }

@media (max-width: 540px) {
  .container { padding: 24px 14px 60px; }
  .room-card-header { flex-wrap: wrap; }
  .room-id-val { font-size: 1.2rem; }
}
</style>
</head>
<body>
<div class="container">

  <div class="header">
    <div class="logo-wrap">
      <div class="logo">Q-ROOM</div>
      <div class="logo-tag">ACTIVE ROOMS</div>
    </div>
    <div class="status-row">
      <div class="dot" id="dot"></div>
      <div class="status-text" id="status-text">CONNECTING...</div>
      <div class="countdown-text" id="countdown-text"></div>
    </div>
  </div>

  <div class="error-box" id="error-box">
    <div class="error-title">‚ùå ERROR</div>
    <div class="error-msg" id="error-msg"></div>
  </div>

  <div class="summary-bar">
    <div class="summary-chip">
      <div class="chip-label">Active Rooms</div>
      <div class="chip-val loading-shimmer" id="chip-rooms" style="color:var(--cyan)">‚Äî</div>
    </div>
    <div class="summary-chip">
      <div class="chip-label">Players Online</div>
      <div class="chip-val loading-shimmer" id="chip-players" style="color:var(--green)">‚Äî</div>
    </div>
    <div class="summary-chip">
      <div class="chip-label">Last Updated</div>
      <div class="chip-val" id="chip-time" style="color:var(--muted);font-size:1rem;padding-top:4px;letter-spacing:0.05em">‚Äî:‚Äî:‚Äî</div>
    </div>
  </div>

  <div class="section-title">
    PLAYING
    <span class="section-count" id="playing-count">0</span>
    <span style="flex:1;height:1px;background:var(--border);display:block"></span>
  </div>
  <div class="rooms-list" id="rooms-active">
    <div class="empty"><div class="empty-icon">üéÆ</div><div class="empty-text loading-shimmer">Ë™≠„ÅøËæº„Åø‰∏≠...</div></div>
  </div>

  <div style="margin-top:32px;">
    <button class="finished-toggle" id="fin-toggle" onclick="toggleFinished()">‚ñ∂ ÁµÇ‰∫ÜÊ∏à„Åø„É´„Éº„É†„ÇíË°®Á§∫</button>
    <div class="rooms-list" id="rooms-finished" style="display:none"></div>
  </div>

  <div class="footer">
    Q-Room Active Rooms &nbsp;¬∑&nbsp; 60Áßí„Åî„Å®„Å´Ëá™ÂãïÊõ¥Êñ∞<br>
    <a href="https://astro-root.com/q-room/" target="_blank">Q-Room„ÅßÈÅä„Å∂</a>
    &nbsp;¬∑&nbsp;
    <a href="https://console.firebase.google.com/project/q-room-fe8a6/database" target="_blank">Firebase Console</a>
  </div>

</div>

<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyA3xtGLVJwij2BTiiOk7DsNeF9hIOuZCyI",
  authDomain: "q-room-fe8a6.firebaseapp.com",
  databaseURL: "https://q-room-fe8a6-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "q-room-fe8a6",
  storageBucket: "q-room-fe8a6.firebasestorage.app",
  messagingSenderId: "151049149394",
  appId: "1:151049149394:web:7a3ea6406454f6a87d460b"
};

const ADMIN_HASH = '1f05d74edef006760f3b1f964820887e991f266be0015dcef0dd41b85eb7e8e9';

const RULE_LABELS = {
  survival:'„Çµ„Éê„Ç§„Éê„É´', free:'„Éï„É™„Éº', newyork:'New York', rentou:'ÈÄ£Á≠î',
  updown:'UpDown', by:'BY', freeze:'„Éï„É™„Éº„Ç∫', m_n_rest:'MN‰ºëÊÜ©',
  swedish:'„Çπ„Ç¶„Çß„Éº„Éá„É≥', ren_wrong:'ÈÄ£Á∂ö‰∏çÊ≠£Ëß£', divide:'ÂàÜÈÖç',
  combo:'„Ç≥„É≥„Éú', attack_surv:'ÊîªÊíÉ„Çµ„Éê„Ç§„Éê„É´', lucky:'„É©„ÉÉ„Ç≠„Éº',
  spiral:'„Çπ„Éë„Ç§„É©„É´', time_race:'„Çø„Ç§„É†„É¨„Éº„Çπ'
};

const QROOM_BASE = 'https://astro-root.com/q-room/';

let db = null;
let countdownSec = 60;
let countdownTimer = null;
let finishedVisible = false;
let isAdmin = false;
let peekListener = null;
let peekRid = null;

function initFB() {
  if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
  db = firebase.database();
  db.ref('.info/connected').on('value', snap => {
    const ok = snap.val() === true;
    document.getElementById('dot').className = 'dot' + (ok ? '' : ' offline');
    document.getElementById('status-text').textContent = ok ? 'LIVE' : 'OFFLINE';
  });
}

function formatTime(ts) {
  if (!ts) return '‚Äî';
  const d = new Date(ts);
  return String(d.getHours()).padStart(2,'0') + ':' +
         String(d.getMinutes()).padStart(2,'0') + ':' +
         String(d.getSeconds()).padStart(2,'0');
}

function timeAgo(ts) {
  if (!ts) return '‚Äî';
  const sec = Math.floor((Date.now() - ts) / 1000);
  if (sec < 60) return sec + 'ÁßíÂâç';
  if (sec < 3600) return Math.floor(sec / 60) + 'ÂàÜÂâç';
  return Math.floor(sec / 3600) + 'ÊôÇÈñìÂâç';
}

function copyRoomId(rid, btn) {
  navigator.clipboard.writeText(rid).then(() => {
    btn.textContent = '‚úì COPIED';
    btn.classList.add('copied');
    setTimeout(() => {
      btn.textContent = 'COPY ID';
      btn.classList.remove('copied');
    }, 2000);
  }).catch(() => {
    btn.textContent = '‚úì COPIED';
    btn.classList.add('copied');
    setTimeout(() => {
      btn.textContent = 'COPY ID';
      btn.classList.remove('copied');
    }, 2000);
  });
}

function getPlayerStatusClass(st) {
  if (st === 'win') return 'st-win';
  if (st === 'lose') return 'st-lose';
  if (st === 'spectator') return 'st-spec';
  return 'st-active';
}

function buildRoomCard(rid, room, idx) {
  const players = room.players || {};
  const playerList = Object.values(players);
  const activePlayers = playerList.filter(p => p.st === 'active');
  const isFinished = room.status === 'finished' || playerList.length === 0;
  const ruleName = RULE_LABELS[room.rule] || room.rule || '?';
  const createdAt = room.createdAt || room.lastActiveAt || null;
  const lastActive = room.lastActiveAt || room.createdAt || null;

  const avatarChar = (name) => name ? name.charAt(0).toUpperCase() : '?';

  const playersHtml = playerList.length === 0
    ? '<div style="font-family:var(--mono);font-size:0.78rem;color:var(--muted);">„Éó„É¨„Ç§„É§„Éº„Å™„Åó</div>'
    : playerList.map(p => {
        const sc = p.sc !== undefined ? p.sc : 0;
        const stClass = getPlayerStatusClass(p.st);
        const isWin = p.st === 'win';
        return `
        <div class="player-chip ${stClass}">
          <div class="player-avatar ${isWin ? 'win' : ''}">${avatarChar(p.name)}</div>
          <span class="player-name">${escHtml(p.name || '?')}</span>
          <span class="player-score"><span class="player-sc-val ${isWin ? 'win' : ''}">${sc}</span>pt</span>
        </div>`;
      }).join('');

  return `
  <div class="room-card ${isFinished ? 'finished' : ''}" style="animation-delay:${idx * 0.06}s">
    <div class="room-card-header">
      <div class="room-id-wrap">
        <div class="live-dot ${isFinished ? 'fin' : ''}"></div>
        <div>
          <div class="room-id-label">ROOM ID</div>
          <div class="room-id-val">${rid}</div>
        </div>
      </div>
      <div class="rule-badge">${ruleName}</div>
      <button class="copy-btn" onclick="copyRoomId('${rid}', this)">COPY ID</button>
      <button class="peek-btn" onclick="openPeek('${rid}')">üëÅ PEEK</button>
      <button class="ghost-btn" onclick="window.open('${QROOM_BASE}?r=${rid}&ghost=1','_blank')">üëª GHOST</button>
      <button class="join-btn" onclick="window.open('${QROOM_BASE}?r=${rid}','_blank')">‚Üí ÂèÇÂä†</button>
    </div>
    <div class="room-meta">
      <div class="meta-item">
        <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        ‰ΩúÊàê: <span>${formatTime(createdAt)}</span>
      </div>
      <div class="meta-item">
        <svg viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
        ÊúÄÁµÇÊõ¥Êñ∞: <span>${timeAgo(lastActive)}</span>
      </div>
      <div class="meta-item">
        <svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        <span>${playerList.length}</span> „Éó„É¨„Ç§„É§„ÉºÔºà„Ç¢„ÇØ„ÉÜ„Ç£„Éñ: <span>${activePlayers.length}</span>Ôºâ
      </div>
      <div class="meta-item">
        <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        Áä∂ÊÖã: <span style="color:${isFinished ? 'var(--muted)' : 'var(--green)'}">${isFinished ? 'ÁµÇ‰∫Ü' : '„Éó„É¨„Ç§‰∏≠'}</span>
      </div>
    </div>
    <div class="players-wrap">
      <div class="players-title">PLAYERS</div>
      <div class="players-grid">${playersHtml}</div>
    </div>
  </div>`;
}

function escHtml(str) {
  return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

async function fetchRooms() {
  if (!db) return;
  try {
    const snap = await db.ref('rooms').once('value');
    const roomsData = snap.val() || {};
    const roomKeys = Object.keys(roomsData);

    const ACTIVE_THRESHOLD_MS = 30 * 60 * 1000;
    const FINISHED_THRESHOLD_MS = 7 * 24 * 60 * 60 * 1000;
    const now_ms = Date.now();

    const active = [], finished = [];
    roomKeys.forEach(rid => {
      const room = roomsData[rid];
      const lastActive = room.lastActiveAt || room.createdAt || 0;
      const isActiveRecent = (now_ms - lastActive) < ACTIVE_THRESHOLD_MS;
      const isFinishedRecent = (now_ms - lastActive) < FINISHED_THRESHOLD_MS;

      const players = room.players || {};
      const activePlayers = Object.values(players).filter(p => {
        const playerTs = p.statsAt || p.joined || 0;
        return (now_ms - playerTs) < ACTIVE_THRESHOLD_MS;
      });

      if (!isActiveRecent || room.status === 'finished' || activePlayers.length === 0) {
        if (isFinishedRecent) finished.push({ rid, room });
      } else {
        const filteredRoom = { ...room, players: Object.fromEntries(
          Object.entries(players).filter(([, p]) => {
            const playerTs = p.statsAt || p.joined || 0;
            return (now_ms - playerTs) < ACTIVE_THRESHOLD_MS;
          })
        )};
        active.push({ rid, room: filteredRoom });
      }
    });

    active.sort((a, b) => (b.room.lastActiveAt || 0) - (a.room.lastActiveAt || 0));
    finished.sort((a, b) => (b.room.lastActiveAt || 0) - (a.room.lastActiveAt || 0));

    const totalPlayers = active.reduce((s, { room }) => s + Object.keys(room.players || {}).length, 0);

    document.getElementById('chip-rooms').textContent = active.length;
    document.getElementById('chip-rooms').classList.remove('loading-shimmer');
    document.getElementById('chip-players').textContent = totalPlayers;
    document.getElementById('chip-players').classList.remove('loading-shimmer');
    const now = new Date();
    document.getElementById('chip-time').textContent =
      String(now.getHours()).padStart(2,'0') + ':' +
      String(now.getMinutes()).padStart(2,'0') + ':' +
      String(now.getSeconds()).padStart(2,'0');

    document.getElementById('playing-count').textContent = active.length;

    const activeEl = document.getElementById('rooms-active');
    if (active.length === 0) {
      activeEl.innerHTML = `<div class="empty"><div class="empty-icon">üéÆ</div><div class="empty-text">ÁèæÂú®„Éó„É¨„Ç§‰∏≠„ÅÆ„É´„Éº„É†„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</div></div>`;
    } else {
      activeEl.innerHTML = active.map(({ rid, room }, i) => buildRoomCard(rid, room, i)).join('');
    }

    const finEl = document.getElementById('rooms-finished');
    if (finished.length === 0) {
      finEl.innerHTML = `<div class="empty"><div class="empty-text">ÁµÇ‰∫ÜÊ∏à„Åø„É´„Éº„É†„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</div></div>`;
    } else {
      const grouped = {};
      finished.forEach(({ rid, room }) => {
        const ts = room.lastActiveAt || room.createdAt || 0;
        const dateKey = getDateLabel(ts);
        if (!grouped[dateKey]) grouped[dateKey] = { label: dateKey, items: [], ts };
        grouped[dateKey].items.push({ rid, room });
        if (ts > grouped[dateKey].ts) grouped[dateKey].ts = ts;
      });
      const sortedGroups = Object.values(grouped).sort((a, b) => b.ts - a.ts);
      finEl.innerHTML = sortedGroups.map((group, gi) => {
        const cardsHtml = group.items.map(({ rid, room }, i) => buildRoomCard(rid, room, i)).join('');
        const isOpen = gi === 0;
        return `
        <div class="date-group" id="dg-${gi}">
          <button class="date-group-toggle ${isOpen ? 'open' : ''}" onclick="toggleDateGroup(${gi})">
            <span class="date-group-arrow">${isOpen ? '‚ñº' : '‚ñ∂'}</span>
            <span class="date-group-label">${group.label}</span>
            <span class="date-group-count">${group.items.length} „É´„Éº„É†</span>
          </button>
          <div class="date-group-body rooms-list" style="display:${isOpen ? 'flex' : 'none'};flex-direction:column;gap:16px;margin-bottom:12px;">
            ${cardsHtml}
          </div>
        </div>`;
      }).join('');
    }
    document.getElementById('fin-toggle').textContent =
      (finishedVisible ? '‚ñº ' : '‚ñ∂ ') + `ÁµÇ‰∫ÜÊ∏à„Åø„É´„Éº„É†„ÇíË°®Á§∫ (${finished.length})`;

    document.getElementById('error-box').style.display = 'none';

  } catch(e) {
    const errBox = document.getElementById('error-box');
    errBox.style.display = 'block';
    let msg = e.message || String(e);
    if (msg.includes('permission') || msg.includes('PERMISSION_DENIED')) {
      msg += '<br><br>‚Üí Firebase „Çª„Ç≠„É•„É™„ÉÜ„Ç£„É´„Éº„É´„Åß <code>/rooms</code> „ÅÆË™≠„ÅøÂèñ„Çä„ÅåÊãíÂê¶„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ<br>'
           + '<a href="https://console.firebase.google.com/project/q-room-fe8a6/database/q-room-fe8a6-default-rtdb/rules" target="_blank" style="color:var(--cyan)">„É´„Éº„É´Ë®≠ÂÆö„ÇíÁ¢∫Ë™ç„Åô„Çã</a>';
    }
    document.getElementById('error-msg').innerHTML = msg;
  }
}

function toggleFinished() {
  finishedVisible = !finishedVisible;
  const el = document.getElementById('rooms-finished');
  el.style.display = finishedVisible ? 'block' : 'none';
}

function getDateLabel(ts) {
  if (!ts) return '‰∏çÊòé';
  const d = new Date(ts);
  const today = new Date();
  const yesterday = new Date(today);
  yesterday.setDate(today.getDate() - 1);
  const isSameDay = (a, b) =>
    a.getFullYear() === b.getFullYear() &&
    a.getMonth() === b.getMonth() &&
    a.getDate() === b.getDate();
  if (isSameDay(d, today)) return '‰ªäÊó•';
  if (isSameDay(d, yesterday)) return 'Êò®Êó•';
  return `${d.getMonth() + 1}Êúà${d.getDate()}Êó•`;
}

function toggleDateGroup(gi) {
  const btn = document.querySelector(`#dg-${gi} .date-group-toggle`);
  const body = document.querySelector(`#dg-${gi} .date-group-body`);
  const arrow = btn.querySelector('.date-group-arrow');
  const isOpen = body.style.display !== 'none';
  body.style.display = isOpen ? 'none' : 'flex';
  if (!isOpen) body.style.flexDirection = 'column';
  btn.classList.toggle('open', !isOpen);
  arrow.textContent = isOpen ? '‚ñ∂' : '‚ñº';
}

function startCountdown() {
  clearInterval(countdownTimer);
  countdownSec = 60;
  countdownTimer = setInterval(() => {
    countdownSec--;
    document.getElementById('countdown-text').textContent = `NEXT: ${countdownSec}s`;
    if (countdownSec <= 0) {
      clearInterval(countdownTimer);
      fetchRooms().then(() => startCountdown());
    }
  }, 1000);
}

function openPeek(rid) {
  _doOpenPeek(rid);
}

function _doOpenPeek(rid) {
  if (!db) { alert('FirebaseÊú™Êé•Á∂ö„Åß„Åô„ÄÇ„Åó„Å∞„Çâ„ÅèÂæÖ„Å£„Å¶„Åã„ÇâÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'); return; }
  closePeek();
  peekRid = rid;
  document.getElementById('peek-rid').textContent = 'ROOM ' + rid;
  document.getElementById('peek-overlay').classList.add('show');
  document.getElementById('peek-drawer').classList.add('open');
  document.body.style.overflow = 'hidden';

  peekListener = db.ref('rooms/' + rid).on('value', snap => {
    const room = snap.val();
    if (!room) {
      document.getElementById('peek-body').innerHTML =
        '<div style="text-align:center;padding:40px;color:var(--red);font-family:var(--mono);">„É´„Éº„É†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì</div>';
      return;
    }
    renderPeek(rid, room);
  });
}

function closePeek() {
  if (peekListener && peekRid && db) {
    db.ref('rooms/' + peekRid).off('value', peekListener);
    peekListener = null;
  }
  peekRid = null;
  document.getElementById('peek-overlay').classList.remove('show');
  document.getElementById('peek-drawer').classList.remove('open');
  document.body.style.overflow = '';
}

function renderPeek(rid, room) {
  const RULE_LABEL_MAP = {
    survival:'„Çµ„Éê„Ç§„Éê„É´', free:'„Éï„É™„Éº', newyork:'New York', rentou:'ÈÄ£Á≠î',
    updown:'UpDown', by:'BY', freeze:'„Éï„É™„Éº„Ç∫', m_n_rest:'MN‰ºëÊÜ©',
    swedish:'„Çπ„Ç¶„Çß„Éº„Éá„É≥', ren_wrong:'ÈÄ£Á∂ö‰∏çÊ≠£Ëß£', divide:'ÂàÜÈÖç',
    combo:'„Ç≥„É≥„Éú', attack_surv:'ÊîªÊíÉ„Çµ„Éê„Ç§„Éê„É´', lucky:'„É©„ÉÉ„Ç≠„Éº',
    spiral:'„Çπ„Éë„Ç§„É©„É´', time_race:'„Çø„Ç§„É†„É¨„Éº„Çπ'
  };
  const players = room.players || {};
  const playerList = Object.entries(players).sort((a, b) => (b[1].sc || 0) - (a[1].sc || 0));
  const timer = room.timer || null;
  const ruleName = RULE_LABEL_MAP[room.rule] || room.rule || '?';
  const now_d = new Date();
  const ts = String(now_d.getHours()).padStart(2,'0') + ':' +
              String(now_d.getMinutes()).padStart(2,'0') + ':' +
              String(now_d.getSeconds()).padStart(2,'0');

  const stColor = room.status === 'playing' ? 'var(--green)' : room.status === 'finished' ? 'var(--muted)' : 'var(--yellow)';

  let timerHtml = '';
  if (timer) {
    const tState = timer.state || '‚Äî';
    const tRem = timer.remaining !== undefined ? Math.max(0, Math.ceil(timer.remaining / 1000)) : '‚Äî';
    const mm = typeof tRem === 'number' ? String(Math.floor(tRem/60)).padStart(2,'0') : '‚Äî';
    const ss = typeof tRem === 'number' ? String(tRem%60).padStart(2,'0') : '‚Äî';
    timerHtml = `
    <div class="peek-section">
      <div class="peek-section-title">TIMER</div>
      <div class="peek-kv"><span class="peek-key">STATE</span><span class="peek-val" style="color:${tState==='running'?'var(--green)':tState==='finished'?'var(--red)':'var(--muted)'}">${tState.toUpperCase()}</span></div>
      <div class="peek-kv"><span class="peek-key">REMAINING</span><span class="peek-val">${mm}:${ss}</span></div>
    </div>`;
  }

  const playersHtml = playerList.length === 0
    ? '<div style="color:var(--muted);font-family:var(--mono);font-size:0.8rem;padding:8px;">„Éó„É¨„Ç§„É§„Éº„Å™„Åó</div>'
    : playerList.map(([pid, p], i) => {
        const isWin = p.st === 'win';
        const isLose = p.st === 'lose';
        return `
        <div class="peek-player-row ${isWin?'win':isLose?'lose':''}">
          <div style="color:var(--muted);font-family:var(--mono);font-size:0.75rem;min-width:18px;">${i+1}</div>
          <div class="peek-avatar ${isWin?'win':''}">${(p.name||'?').charAt(0).toUpperCase()}</div>
          <div class="peek-pname">${escHtml(p.name||'?')}</div>
          <div class="peek-stats">
            <span>‚úì${p.c||0}</span>
            <span>‚úó${p.w||0}</span>
            <span class="sc ${isWin?'win':''}">${p.sc||0}pt</span>
          </div>
          <div style="font-family:var(--mono);font-size:0.68rem;color:${
            p.st==='active'?'var(--green)':p.st==='win'?'var(--green)':p.st==='lose'?'var(--red)':'var(--muted)'
          };min-width:40px;text-align:right;">${(p.st||'?').toUpperCase()}</div>
        </div>`;
      }).join('');

  document.getElementById('peek-body').innerHTML = `
    <div class="peek-section">
      <div class="peek-section-title">ROOM INFO <div class="peek-live-dot" style="border-radius:50%"></div></div>
      <div class="peek-kv"><span class="peek-key">RULE</span><span class="peek-val">${ruleName}</span></div>
      <div class="peek-kv"><span class="peek-key">STATUS</span><span class="peek-val" style="color:${stColor}">${(room.status||'?').toUpperCase()}</span></div>
      <div class="peek-kv"><span class="peek-key">PLAYERS</span><span class="peek-val">${playerList.length} ‰∫∫</span></div>
      <div class="peek-kv"><span class="peek-key">CREATED</span><span class="peek-val">${room.createdAt ? new Date(room.createdAt).toLocaleTimeString('ja-JP') : '‚Äî'}</span></div>
      <div class="peek-kv"><span class="peek-key">LAST ACTIVE</span><span class="peek-val">${room.lastActiveAt ? new Date(room.lastActiveAt).toLocaleTimeString('ja-JP') : '‚Äî'}</span></div>
    </div>
    ${timerHtml}
    <div class="peek-section">
      <div class="peek-section-title">PLAYERS („Çπ„Ç≥„Ç¢È†Ü)</div>
      ${playersHtml}
    </div>
    <div style="text-align:right;font-family:var(--mono);font-size:0.65rem;color:rgba(255,255,255,0.2);margin-top:8px;">Êõ¥Êñ∞: ${ts}</div>
  `;
}

function activateAdmin() {
  isAdmin = true;
  sessionStorage.setItem('qr_admin', '1');
  document.body.classList.add('admin-mode');
  const hdr = document.querySelector('.status-row');
  if (!document.querySelector('.admin-badge')) {
    const badge = document.createElement('div');
    badge.className = 'admin-badge';
    badge.textContent = '‚ö° ADMIN';
    hdr.prepend(badge);
  }
}

async function checkHash(k) {
  const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(k));
  return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
}

async function submitGate() {
  const key = document.getElementById('gate-input').value;
  if (!key) { document.getElementById('gate-error').textContent = '„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ'; return; }
  const hash = await checkHash(key);
  if (hash !== ADMIN_HASH) {
    document.getElementById('gate-error').textContent = '„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈÅï„ÅÑ„Åæ„Åô';
    document.getElementById('gate-input').value = '';
    document.getElementById('gate-input').focus();
    return;
  }
  sessionStorage.setItem('qr_admin', '1');
  document.getElementById('gate-overlay').classList.remove('show');
  document.body.style.overflow = '';
  initFB();
  fetchRooms().then(() => startCountdown());
}

window.addEventListener('load', async () => {
  const params = new URLSearchParams(window.location.search);
  const key = params.get('admin');

  if (key) {
    const hash = await checkHash(key);
    if (hash === ADMIN_HASH) {
      sessionStorage.setItem('qr_admin', '1');
      history.replaceState({}, '', window.location.pathname);
    } else {
      document.getElementById('gate-error').textContent = '„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈÅï„ÅÑ„Åæ„Åô';
      document.getElementById('gate-overlay').classList.add('show');
      document.body.style.overflow = 'hidden';
      return;
    }
  } else if (sessionStorage.getItem('qr_admin') !== '1') {
    document.getElementById('gate-overlay').classList.add('show');
    document.body.style.overflow = 'hidden';
    setTimeout(() => document.getElementById('gate-input').focus(), 80);
    return;
  }

  initFB();
  fetchRooms().then(() => startCountdown());
});
</script>

<!-- SITE GATE -->
<div class="gate-overlay" id="gate-overlay">
  <div class="gate-box">
    <div class="gate-logo">Q-ROOM</div>
    <div class="gate-sub">ACTIVE ROOMS ¬∑ RESTRICTED</div>
    <input class="gate-input" id="gate-input" type="password" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ"
      onkeydown="if(event.key==='Enter')submitGate()">
    <div class="gate-error" id="gate-error"></div>
    <button class="gate-btn" onclick="submitGate()">‚Üí „Ç¢„ÇØ„Çª„Çπ</button>
  </div>
</div>

<!-- ADMIN PEEK PANEL -->
<div class="peek-overlay" id="peek-overlay" onclick="closePeek()"></div>
<div class="peek-drawer" id="peek-drawer">
  <div class="peek-header">
    <div>
      <div class="peek-title">üëÅ ADMIN PEEK</div>
      <div class="peek-rid" id="peek-rid">‚Äî</div>
    </div>
    <button class="peek-close" onclick="closePeek()">‚úï</button>
  </div>
  <div class="peek-body" id="peek-body">
    <div style="text-align:center;padding:40px;color:var(--muted);font-family:var(--mono);font-size:0.82rem;">Ë™≠„ÅøËæº„Åø‰∏≠...</div>
  </div>
  <div class="peek-footer">READ-ONLY ¬∑ Firebase „Å∏„ÅÆÊõ∏„ÅçËæº„Åø„Å™„Åó ¬∑ ‰ªñ„ÅÆ„Éó„É¨„Ç§„É§„Éº„Å´„ÅØË¶ã„Åà„Åæ„Åõ„Çì</div>
</div>

</body>
</html>
